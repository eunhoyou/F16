<?xml version="1.0"?>
<root BTCPP_format="4">
	<BehaviorTree ID="F16_BFM_Tree">
		<!-- 메인 시퀀스 -->
		<Sequence name="Main_Sequence">

			<!-- 상황 업데이트 -->
			<Sequence name="Update_Sequence">
				<DirectionVectorUpdate BB="{BB}" />
				<DistanceUpdate BB="{BB}" />
				<CheckSight BB="{BB}" />
				<AngleOffUpdate BB="{BB}" />
				<AspectAngleUpdate BB="{BB}" />
				<BFM_ModeDetermination BB="{BB}" />
			</Sequence>

			<!-- BFM 모드별 행동 선택 -->
			<Fallback name="BFM_Mode_Selection">

				<!-- WEZ 내 무기 교전 -->
				<Sequence name="Weapon_Engagement_Priority">
					<DECO_DistanceCheck BB="{BB}" UpDown="Greater" Distance="152.4" />
					<DECO_DistanceCheck BB="{BB}" UpDown="Less" Distance="914.4" />
					<DECO_LOSCheck BB="{BB}" UpDown="Less" InputLOS="2.0" />
					<Task_WeaponEngagement BB="{BB}" />
				</Sequence>

				<!-- 탐지 모드 -->
				<Sequence name="Detecting_Mode">
					<DECO_BFMCheck BB="{BB}" CheckBFM="DETECTING" />
					<Task_Detecting BB="{BB}" />
				</Sequence>

				<!-- 공격 BFM -->
				<Sequence name="Offensive_BFM">
					<DECO_BFMCheck BB="{BB}" CheckBFM="OBFM" />
					<Fallback name="Offensive_Actions">
						<!-- WEZ 접근을 위한 근거리 교전 시도 -->
						<Sequence name="Close_Range_Engagement">
							<DECO_DistanceCheck BB="{BB}" UpDown="Less" Distance="1500" />
							<Task_WeaponEngagement BB="{BB}" />
						</Sequence>
						<!-- 일반 공격 BFM -->
						<Task_OffensiveBFM BB="{BB}" />
					</Fallback>
				</Sequence>

				<!-- 방어 BFM -->
				<Sequence name="Defensive_BFM">
					<DECO_BFMCheck BB="{BB}" CheckBFM="DBFM" />
					<Task_DefensiveBFM BB="{BB}" />
				</Sequence>

				<!-- 정면 BFM -->
				<Sequence name="HeadOn_BFM">
					<DECO_BFMCheck BB="{BB}" CheckBFM="HABFM" />
					<Task_HeadOnBFM BB="{BB}" />
				</Sequence>

				<!-- 시저스 상황 -->
				<Sequence name="Scissors_Mode">
					<DECO_BFMCheck BB="{BB}" CheckBFM="SCISSORS" />
					<Fallback name="Scissors_Actions">
						<!-- WEZ 내에서는 무기 교전 -->
						<Sequence name="WEZ_Scissors">
							<DECO_DistanceCheck BB="{BB}" UpDown="Greater" Distance="152.4" />
							<DECO_DistanceCheck BB="{BB}" UpDown="Less" Distance="914.4" />
							<DECO_LOSCheck BB="{BB}" UpDown="Less" InputLOS="2.0" />
							<Task_WeaponEngagement BB="{BB}" />
						</Sequence>
						<!-- 일반 시저스 - 방어적 기동 -->
						<Task_DefensiveBFM BB="{BB}" />
					</Fallback>
				</Sequence>

				<!-- 기본 행동 (아무것도 해당되지 않을 때) -->
				<Task_Pure BB="{BB}" />

			</Fallback>

			<!-- 모든 행동 후 고도 안전성 확인 (반드시 필요!) -->
			<AltitudeSafetyCheck BB="{BB}" />

		</Sequence>
	</BehaviorTree>
</root>